<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAHAIÂ·ç§äººå½±é™¢ | æ²‰æµ¸å¼è§‚å½±ä½“éªŒ</title>
    <style>
        /* å…¨å±€é‡ç½®ä¸åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00d4ff;      /* ç§‘æŠ€è“ */
            --secondary: #9d4edd;    /* ç´«ç½—å…° */
            --accent: #ff6b6b;       /* çŠç‘šçº¢ */
            --dark: #0a0a0f;         /* æ·±ç©ºé»‘ */
            --darker: #050508;       /* æ›´æ·±çš„é»‘ */
            --light: #e0e0e0;        /* æµ…ç° */
            --glass: rgba(255, 255, 255, 0.05);
            --glow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, #0f172a 100%);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* èƒŒæ™¯ç²’å­æ•ˆæœ */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }

        /* å¯¼èˆªæ  - ç§‘å¹»é£æ ¼ */
        .navbar {
            background: rgba(10, 10, 15, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
            padding: 1.2rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--glow);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .logo::before {
            content: "â–¶";
            color: var(--primary);
            font-size: 1.5rem;
            animation: pulse 2s infinite;
        }

        .nav-center {
            display: flex;
            gap: 2.5rem;
            align-items: center;
        }

        .nav-item {
            position: relative;
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        .nav-item:hover {
            color: var(--primary);
        }

        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), transparent);
            transition: width 0.3s ease;
        }

        .nav-item:hover::after {
            width: 100%;
        }

        /* ä¸»æœç´¢åŒºåŸŸ - å±…ä¸­å¤§æ°” */
        .hero {
            margin-top: 120px;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: -1px;
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: rgba(224, 224, 224, 0.8);
            max-width: 700px;
            margin: 0 auto 3rem;
            line-height: 1.6;
        }

        /* ä¸»æœç´¢æ¡† */
        .search-container {
            max-width: 800px;
            margin: 0 auto 3rem;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 1.5rem 2rem;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(0, 212, 255, 0.2);
            border-radius: 15px;
            color: var(--light);
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .search-box:focus {
            border-color: var(--primary);
            box-shadow: var(--glow);
            background: rgba(255, 255, 255, 0.12);
        }

        .search-box::placeholder {
            color: rgba(224, 224, 224, 0.5);
        }

        .search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: var(--glow);
        }

        /* å¿«é€Ÿåˆ†ç±»æŒ‰é’® */
        .quick-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .quick-link {
            background: var(--glass);
            border: 1px solid rgba(0, 212, 255, 0.1);
            padding: 0.8rem 1.8rem;
            border-radius: 25px;
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quick-link:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* è§†é¢‘ç½‘æ ¼ - å¡ç‰‡å¼è®¾è®¡ */
        .section-title {
            font-size: 2.2rem;
            margin: 4rem 0 2rem;
            padding-left: 2rem;
            position: relative;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .section-title::before {
            content: '';
            width: 5px;
            height: 40px;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: 3px;
        }

        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            padding: 0 2rem;
            margin-bottom: 4rem;
        }

        .movie-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.4s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--primary);
            box-shadow: var(--glow);
            background: rgba(255, 255, 255, 0.08);
        }

        .card-img {
            width: 100%;
            height: 380px;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .movie-card:hover .card-img {
            transform: scale(1.1);
        }

        .card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 2rem 1.5rem 1.5rem;
            transform: translateY(100%);
            transition: transform 0.4s ease;
        }

        .movie-card:hover .card-overlay {
            transform: translateY(0);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: white;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .card-actions {
            display: flex;
            gap: 0.8rem;
        }

        .watch-btn, .info-btn, .load-more-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .watch-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }

        .info-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .watch-btn:hover, .info-btn:hover, .load-more-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* è§†é¢‘æ’­æ”¾å™¨æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            width: 90%;
            max-width: 1200px;
            background: rgba(20, 20, 30, 0.95);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(0, 212, 255, 0.2);
            box-shadow: 0 0 50px rgba(0, 212, 255, 0.2);
        }

        .modal-header {
            padding: 1.5rem 2rem;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--light);
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent);
        }

        .video-container {
            padding: 2rem;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* é¡µè„š */
        .footer {
            background: rgba(5, 5, 8, 0.95);
            padding: 4rem 2rem 2rem;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
        }

        .footer-section h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.8rem;
        }

        .footer-links a {
            color: rgba(224, 224, 224, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .footer-links a:hover {
            color: var(--primary);
            transform: translateX(5px);
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .social-link:hover {
            background: var(--primary);
            transform: translateY(-5px);
        }

        .copyright {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            color: rgba(224, 224, 224, 0.5);
            font-size: 0.9rem;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .nav-center {
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .movies-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
                padding: 0 1rem;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .video-container {
                padding: 1rem;
                min-height: 400px;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loader {
            display: none;
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 212, 255, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--darker);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--secondary), var(--primary));
        }

        /* ===== ä»…æ–°å¢çš„å°ç»„ä»¶æ ·å¼ï¼šä¿æŒåŸç§‘å¹»é£æ ¼ï¼Œä¸æ”¹æ•´ä½“å¸ƒå±€ ===== */
        .center-row {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 2rem 4rem;
        }

        .load-more-btn {
            max-width: 260px;
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            color: var(--light);
            border: 1px solid rgba(0, 212, 255, 0.25);
            backdrop-filter: blur(10px);
        }

        .load-more-btn i {
            color: var(--primary);
        }

        .empty-hint {
            padding: 0 2rem 4rem;
            text-align: center;
            color: rgba(224, 224, 224, 0.7);
        }

        .toast {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 5000;
            background: rgba(20, 20, 30, 0.92);
            border: 1px solid rgba(0, 212, 255, 0.25);
            box-shadow: 0 0 25px rgba(0, 212, 255, 0.18);
            border-radius: 14px;
            padding: 12px 14px;
            max-width: 360px;
            display: none;
            backdrop-filter: blur(12px);
        }

        .toast-title {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 6px;
        }

        .toast-text {
            font-size: 0.95rem;
            color: rgba(224, 224, 224, 0.85);
            line-height: 1.5;
        }

        .toast-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .toast-actions button {
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(255,255,255,0.06);
            color: var(--light);
            padding: 8px 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all .2s ease;
        }

        .toast-actions button:hover {
            transform: translateY(-2px);
            border-color: rgba(0, 212, 255, 0.45);
            box-shadow: 0 0 18px rgba(0, 212, 255, 0.12);
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- èƒŒæ™¯ç²’å­ -->
    <div id="particles-js"></div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="logo">DAHAI CINEMA</div>
        <div class="nav-center">
            <a href="#" class="nav-item"><i class="fas fa-home"></i> é¦–é¡µ</a>
            <a href="#movies" class="nav-item"><i class="fas fa-film"></i> ç”µå½±</a>
            <a href="#tv" class="nav-item"><i class="fas fa-tv"></i> å‰§é›†</a>
            <a href="#anime" class="nav-item"><i class="fas fa-gamepad"></i> åŠ¨æ¼«</a>
            <a href="#collections" class="nav-item"><i class="fas fa-star"></i> æ”¶è—</a>
        </div>
        <div class="user-menu">
            <button class="nav-item" id="userBtn"><i class="fas fa-user"></i> å¤§æµ·</button>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main>
        <!-- è‹±é›„åŒºåŸŸ -->
        <section class="hero">
            <h1 class="hero-title floating">æ²‰æµ¸å¼ç§äººè§‚å½±ä½“éªŒ</h1>
            <p class="hero-subtitle">
                ä¸€ä¸ªå®Œå…¨å±äºä½ çš„å½±è§†ç©ºé—´ Â· ç²¾é€‰å…¨çƒä¼˜è´¨å†…å®¹ Â· æ— å¹¿å‘Šå¹²æ‰° Â· ä¸ªæ€§æ¨è
            </p>
            
            <!-- æœç´¢æ¡† -->
            <div class="search-container">
                <input type="text" 
                       class="search-box" 
                       placeholder="æœç´¢ç”µå½±ã€å‰§é›†ã€åŠ¨æ¼«ï¼ˆæ”¯æŒè¾“å…¥ BV å·æˆ– Bç«™é“¾æ¥ï¼‰..." 
                       id="searchInput">
                <button class="search-btn" id="searchBtn">
                    <i class="fas fa-search"></i> æœç´¢
                </button>
            </div>
            
            <!-- å¿«é€Ÿé“¾æ¥ -->
            <div class="quick-links">
                <a href="#" class="quick-link" data-category="action">
                    <i class="fas fa-explosion"></i> åŠ¨ä½œå¤§ç‰‡
                </a>
                <a href="#" class="quick-link" data-category="sci-fi">
                    <i class="fas fa-robot"></i> ç§‘å¹»æœªæ¥
                </a>
                <a href="#" class="quick-link" data-category="drama">
                    <i class="fas fa-theater-masks"></i> å‰§æƒ…ä½³ä½œ
                </a>
                <a href="#" class="quick-link" data-category="comedy">
                    <i class="fas fa-laugh"></i> å–œå‰§è½»æ¾
                </a>
                <a href="#" class="quick-link" data-category="anime">
                    <i class="fas fa-dragon"></i> çƒ­è¡€åŠ¨æ¼«
                </a>
            </div>
        </section>

        <!-- æœç´¢ç»“æœï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <h2 class="section-title" id="searchTitle" style="display:none;">
            <i class="fas fa-search"></i> æœç´¢ç»“æœ
        </h2>
        <div class="movies-grid" id="searchMovies" style="display:none;"></div>
        <div class="center-row" id="searchMoreRow" style="display:none;">
            <button class="load-more-btn" id="searchMoreBtn">
                <i class="fas fa-plus"></i> åŠ è½½æ›´å¤š
            </button>
        </div>

        <!-- çƒ­é—¨æ¨è -->
        <h2 class="section-title" id="movies">
            <i class="fas fa-fire"></i> ä»Šæ—¥çƒ­é—¨æ¨è
        </h2>
        <div class="movies-grid" id="hotMovies">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- æœ€æ–°ä¸Šæ˜  -->
        <h2 class="section-title" id="tv">
            <i class="fas fa-bolt"></i> æœ€æ–°ä¸Šæ˜ 
        </h2>
        <div class="movies-grid" id="newMovies">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- æ›´å¤šæ¨èï¼ˆè‡ªåŠ¨æ‹‰å–Bç«™çƒ­é—¨/æœç´¢ç»“æœï¼Œè§†é¢‘æ•°é‡æ˜¾è‘—æå‡ï¼‰ -->
        <h2 class="section-title" id="discoverTitle" style="display:none;">
            <i class="fas fa-compass"></i> æ›´å¤šæ¨è
        </h2>
        <div class="movies-grid" id="discoverMovies" style="display:none;"></div>
        <div class="center-row" id="discoverMoreRow" style="display:none;">
            <button class="load-more-btn" id="discoverMoreBtn">
                <i class="fas fa-rotate"></i> æ¢ä¸€æ‰¹
            </button>
        </div>

        <!-- åŠ è½½åŠ¨ç”» -->
        <div class="loader" id="loader"></div>

        <div class="empty-hint" id="emptyHint" style="display:none;"></div>
    </main>

    <!-- è§†é¢‘æ’­æ”¾å™¨æ¨¡æ€æ¡† -->
    <div class="modal" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">æ­£åœ¨æ’­æ”¾</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="video-container" id="videoContainer">
                <!-- è§†é¢‘å°†åœ¨è¿™é‡ŒåŠ è½½ -->
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <div class="toast-title" id="toastTitle">æç¤º</div>
        <div class="toast-text" id="toastText"></div>
        <div class="toast-actions" id="toastActions"></div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>DAHAI CINEMA</h3>
                <p>ä¸€ä¸ªå®Œå…¨ä¸ªæ€§åŒ–çš„ç§äººè§‚å½±ç©ºé—´ï¼Œä¸ºæ‚¨æä¾›æ²‰æµ¸å¼çš„è§‚å½±ä½“éªŒã€‚</p>
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-github"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-weibo"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-discord"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>å¿«é€Ÿé“¾æ¥</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-chevron-right"></i> ç”µå½±åº“</a></li>
                    <li><a href="#"><i class="fas fa-chevron-right"></i> å‰§é›†åˆ—è¡¨</a></li>
                    <li><a href="#"><i class="fas fa-chevron-right"></i> åŠ¨æ¼«ä¸“åŒº</a></li>
                    <li><a href="#"><i class="fas fa-chevron-right"></i> æˆ‘çš„æ”¶è—</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>æŠ€æœ¯æ”¯æŒ</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-code"></i> GitHub Pages</a></li>
                    <li><a href="#"><i class="fas fa-database"></i> è§†é¢‘èµ„æºAPI</a></li>
                    <li><a href="#"><i class="fas fa-shield-alt"></i> å®‰å…¨åŠ å¯†</a></li>
                    <li><a href="#"><i class="fas fa-bolt"></i> å…¨çƒCDNåŠ é€Ÿ</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            &copy; 2023 DAHAIç§äººå½±é™¢. æœ¬ç½‘ç«™ä»…ä¾›ä¸ªäººå­¦ä¹ äº¤æµä½¿ç”¨ã€‚
            <br>
            è§†é¢‘èµ„æºæ¥æºäºäº’è”ç½‘å…¬å¼€å†…å®¹ï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚
        </div>
    </footer>

    <!-- è„šæœ¬ -->
<script>
        // =========================
        // 0) é…ç½®åŒºï¼ˆå¯é€‰ï¼‰
        // =========================
        const CONFIG = {
            // å¦‚æœä½ çš„ç½‘ç«™éƒ¨ç½²ç¯å¢ƒè¯·æ±‚ Bç«™ API ä¼šé‡åˆ° CORSï¼š
            // 1) å…ˆæŠŠä¸‹é¢ apiProxy ç•™ç©ºè¿è¡Œçœ‹çœ‹ï¼ˆæœ‰äº›ç¯å¢ƒå¯ç›´æ¥è¯·æ±‚æˆåŠŸï¼‰
            // 2) å¦‚æœä¸è¡Œï¼Œå†é…ç½®ä»£ç†ï¼ˆä¾‹å¦‚ Cloudflare Workerï¼‰ï¼Œæ ¼å¼ï¼š "https://your-worker.workers.dev/?url="
            apiProxy: "https://xxxxxx.workers.dev/?url=",

            // æ˜¯å¦åœ¨é¡µé¢åŠ è½½æ—¶å°è¯•â€œè‡ªåŠ¨æ ¡å‡†â€å°é¢/æ ‡é¢˜ï¼ˆæ ¹æ® bvid æ‹‰å–çœŸå®ä¿¡æ¯ï¼‰
            syncMetaOnLoad: true,

            // â€œæ›´å¤šæ¨èâ€æ¯æ¬¡æ‹‰å–æ•°é‡
            discoverPageSize: 24,

            // æœç´¢æ¯é¡µæ•°é‡
            searchPageSize: 24,

            // æœ¬åœ°ç¼“å­˜ï¼ˆå‡å°‘é‡å¤è¯·æ±‚ï¼‰æ—¶é•¿ï¼šåˆ†é’Ÿ
            metaCacheMinutes: 60 * 24
        };

        // =========================
        // =========================
        // 1) ç²’å­èƒŒæ™¯ï¼ˆéé˜»å¡åŠ è½½ï¼šé¿å… CDN å¤±è´¥å¯¼è‡´æ•´ç«™â€œæ— è§†é¢‘/æ— æœç´¢â€ï¼‰
        // =========================
        function loadScriptOnce(src, timeoutMs = 8000) {
            return new Promise((resolve, reject) => {
                // å·²åŠ è½½
                for (const s of document.scripts) {
                    if (s && s.src && s.src === src) return resolve(true);
                }
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                script.crossOrigin = "anonymous";
                let done = false;

                const timer = setTimeout(() => {
                    if (done) return;
                    done = true;
                    script.remove();
                    reject(new Error('Script load timeout: ' + src));
                }, timeoutMs);

                script.onload = () => {
                    if (done) return;
                    done = true;
                    clearTimeout(timer);
                    resolve(true);
                };
                script.onerror = () => {
                    if (done) return;
                    done = true;
                    clearTimeout(timer);
                    script.remove();
                    reject(new Error('Script load error: ' + src));
                };

                document.head.appendChild(script);
            });
        }

        async function ensureParticlesLib() {
            if (typeof window.particlesJS === 'function') return true;

            // å¤š CDN å…œåº•ï¼ˆå“ªä¸ªèƒ½è¿ä¸Šå°±ç”¨å“ªä¸ªï¼‰
            const sources = [
                "https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js",
                "https://fastly.jsdelivr.net/particles.js/2.0.0/particles.min.js",
                "https://unpkg.com/particles.js@2.0.0/particles.min.js"
            ];

            for (const src of sources) {
                try {
                    await loadScriptOnce(src, 6000);
                    if (typeof window.particlesJS === 'function') return true;
                } catch (e) {
                    // å¿½ç•¥ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ª CDN
                }
            }
            return false;
        }

        async function initParticlesBackground() {
            try {
                const ok = await ensureParticlesLib();
                if (!ok) return;

                // è¿™é‡Œæ²¿ç”¨ä½ åŸæ¥çš„ç²’å­å‚æ•°ï¼Œä¿æŒè§†è§‰é£æ ¼ä¸å˜
                particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: "#00d4ff" },
                shape: { type: "circle" },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#00d4ff",
                    opacity: 0.2,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: "none",
                    random: true,
                    straight: false,
                    out_mode: "out",
                    bounce: false
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "repulse" },
                    onclick: { enable: true, mode: "push" }
                }
            },
            retina_detect: true
        });
            } catch (e) {
                // ä¸è¦è®©ç²’å­å¤±è´¥å½±å“ä¸»åŠŸèƒ½ï¼ˆåˆ—è¡¨/æœç´¢/æ’­æ”¾ï¼‰
                console.warn("particles init skipped:", e);
            }
        }

export default {
  async fetch(request, env) {
    const corsHeaders = {
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "GET,OPTIONS",
      "Access-Control-Allow-Headers": "*",
      "Access-Control-Max-Age": "86400",
    };

    if (request.method === "OPTIONS") {
      return new Response(null, { headers: corsHeaders });
    }

    const u = new URL(request.url);
    const target = u.searchParams.get("url");
    if (!target) {
      return new Response("Missing ?url=", { status: 400, headers: corsHeaders });
    }

    let targetUrl;
    try {
      targetUrl = new URL(target);
    } catch {
      return new Response("Bad url", { status: 400, headers: corsHeaders });
    }

    // âœ… å®‰å…¨ï¼šåªå…è®¸ä»£ç† Bç«™ APIï¼Œé¿å…å˜æˆå…¬å…±ä»£ç†
    const ALLOW = new Set(["api.bilibili.com"]);
    if (!ALLOW.has(targetUrl.hostname)) {
      return new Response("Forbidden host", { status: 403, headers: corsHeaders });
    }

    const headers = new Headers();
    headers.set("Accept", "application/json");
    headers.set("Referer", "https://www.bilibili.com/");
    headers.set("Origin", "https://www.bilibili.com");
    headers.set(
      "User-Agent",
      "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36"
    );

    // ğŸ”’ å¯é€‰ï¼šå¦‚æœä½ æƒ³è®©â€œå…³é”®è¯æœç´¢â€æ›´ç¨³å®šï¼Œå¯åœ¨ Worker é‡Œé…ç½®ç¯å¢ƒå˜é‡ BILI_COOKIE
    // Cloudflare â†’ Worker â†’ Settings â†’ Variables â†’ Add variable:
    // Name: BILI_COOKIE
    // Value: ä½ çš„cookieå­—ç¬¦ä¸²ï¼ˆä¸è¦å…¬å¼€ï¼‰
    if (env.BILI_COOKIE) {
      headers.set("Cookie", env.BILI_COOKIE);
    }

    const resp = await fetch(targetUrl.toString(), { method: "GET", headers });

    const outHeaders = new Headers(resp.headers);
    Object.entries(corsHeaders).forEach(([k, v]) => outHeaders.set(k, v));
    outHeaders.set("Cache-Control", "public, max-age=60");

    return new Response(resp.body, { status: resp.status, headers: outHeaders });
  },
};

        const movies = {
            hot: [
                {
                    id: 1,
                    title: "æµæµªåœ°çƒ2",
                    year: "2023",
                    rating: "8.8",
                    duration: "173åˆ†é’Ÿ",
                    category: ["ç§‘å¹»", "ç¾éš¾"],
                    poster: "https://picsum.photos/seed/movie1/400/600",
                    bvid: "BV1fX4y1V7Vc",
                    description: "å¤ªé˜³å³å°†æ¯ç­ï¼Œäººç±»åœ¨åœ°çƒè¡¨é¢å»ºé€ å‡ºå·¨å¤§çš„æ¨è¿›å™¨ï¼Œå¯»æ‰¾æ–°çš„å®¶å›­ã€‚"
                },
                {
                    id: 2,
                    title: "é˜¿å‡¡è¾¾ï¼šæ°´ä¹‹é“",
                    year: "2022",
                    rating: "8.2",
                    duration: "192åˆ†é’Ÿ",
                    category: ["ç§‘å¹»", "å†’é™©"],
                    poster: "https://picsum.photos/seed/movie2/400/600",
                    bvid: "BV1cT411R7tY",
                    description: "è¨åˆ©ä¸€å®¶æ¬åˆ°æ½˜å¤šæ‹‰æ˜Ÿçƒçš„æµ·åŸŸï¼Œå¼€å¯å…¨æ–°å†’é™©ã€‚"
                },
                {
                    id: 3,
                    title: "å¥¥æœ¬æµ·é»˜",
                    year: "2023",
                    rating: "8.7",
                    duration: "180åˆ†é’Ÿ",
                    category: ["ä¼ è®°", "å†å²"],
                    poster: "https://picsum.photos/seed/movie3/400/600",
                    bvid: "BV1Gu4y1U7YJ",
                    description: "åŸå­å¼¹ä¹‹çˆ¶ç½—ä¼¯ç‰¹Â·å¥¥æœ¬æµ·é»˜çš„ä¼ å¥‡ä¸€ç”Ÿã€‚"
                },
                {
                    id: 4,
                    title: "èœ˜è››ä¾ ï¼šçºµæ¨ªå®‡å®™",
                    year: "2023",
                    rating: "9.0",
                    duration: "140åˆ†é’Ÿ",
                    category: ["åŠ¨ç”»", "åŠ¨ä½œ"],
                    poster: "https://picsum.photos/seed/movie4/400/600",
                    bvid: "BV1No4y1Z7K8",
                    description: "è¿ˆå°”æ–¯Â·è«æ‹‰è±æ–¯ç©¿æ¢­å¤šå…ƒå®‡å®™ï¼Œå¼€å¯å…¨æ–°å†’é™©ã€‚"
                }
            ],
            new: [
                {
                    id: 5,
                    title: "ç¢Ÿä¸­è°7",
                    year: "2023",
                    rating: "8.5",
                    duration: "164åˆ†é’Ÿ",
                    category: ["åŠ¨ä½œ", "å†’é™©"],
                    poster: "https://picsum.photos/seed/movie5/400/600",
                    bvid: "BV1Nj411D7V4",
                    description: "ä¼Šæ£®Â·äº¨ç‰¹ä¸IMFå°ç»„è¿æ¥å…¨æ–°è‡´å‘½ä»»åŠ¡ã€‚"
                },
                {
                    id: 6,
                    title: "é—ªç”µä¾ ",
                    year: "2023",
                    rating: "8.3",
                    duration: "144åˆ†é’Ÿ",
                    category: ["åŠ¨ä½œ", "ç§‘å¹»"],
                    poster: "https://picsum.photos/seed/movie6/400/600",
                    bvid: "BV1No4y1Z7K9",
                    description: "å·´é‡ŒÂ·è‰¾ä¼¦åˆ©ç”¨è¶…èƒ½åŠ›ç©¿è¶Šæ—¶ç©ºæ”¹å˜è¿‡å»ã€‚"
                },
                {
                    id: 7,
                    title: "é“¶æ²³æŠ¤å«é˜Ÿ3",
                    year: "2023",
                    rating: "8.7",
                    duration: "150åˆ†é’Ÿ",
                    category: ["ç§‘å¹»", "å–œå‰§"],
                    poster: "https://picsum.photos/seed/movie7/400/600",
                    bvid: "BV1Nj411D7V5",
                    description: "é“¶æ²³æŠ¤å«é˜Ÿæˆå‘˜è¸ä¸Šæœ€ç»ˆå†’é™©ä¹‹æ—…ã€‚"
                },
                {
                    id: 8,
                    title: "é•¿å®‰ä¸‰ä¸‡é‡Œ",
                    year: "2023",
                    rating: "9.1",
                    duration: "168åˆ†é’Ÿ",
                    category: ["åŠ¨ç”»", "å†å²"],
                    poster: "https://picsum.photos/seed/movie8/400/600",
                    bvid: "BV1Nj411D7V6",
                    description: "å¤§å”ç››ä¸–çš„è¯—æ­Œä¸æ¢¦æƒ³ï¼Œæç™½ä¸é«˜é€‚çš„å‹è°Šã€‚"
                }
            ]
        };

        // =========================
        // 3) å…¨å±€çŠ¶æ€ï¼ˆç»Ÿä¸€ç®¡ç†ï¼Œè§£å†³â€œæ ‡é¢˜/å°é¢/æ’­æ”¾ä¸ä¸€è‡´â€çš„æ ¹å› ï¼‰
        // =========================
        const Store = {
            byId: new Map(),   // id -> movie
            byBvid: new Map(), // bvid -> movie
            search: {
                keyword: "",
                page: 1,
                hasMore: false,
                remoteEnabled: true
            },
            discover: {
                page: 1,
                hasMore: true
            }
        };

        function upsertMovie(movie) {
            const id = String(movie.bvid ?? movie.id ?? cryptoRandomId());
            movie.id = id;

            // poster ç»Ÿä¸€å…œåº•ï¼šä¿è¯â€œå°é¢ä¸ä¼šä¸æ ‡é¢˜å®Œå…¨æ— å…³â€
            movie.poster = normalizePoster(movie.poster, movie.title, movie.bvid || id);

            Store.byId.set(id, movie);
            if (movie.bvid) Store.byBvid.set(movie.bvid, movie);
            return movie;
        }

        function cryptoRandomId() {
            return "m_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
        }

        function normalizePoster(posterUrl, title, seed) {
            // ä½ åŸä»£ç ç”¨ picsum éšæœºå›¾ï¼Œä¼šé€ æˆâ€œå°é¢ä¸æ ‡é¢˜ä¸ä¸€è‡´â€
            // è¿™é‡Œæ”¹æˆï¼šé»˜è®¤ç”¨â€œå¯è¯»å°é¢(å¸¦æ ‡é¢˜)â€ä½œä¸ºå…œåº•ï¼Œä¿è¯ä¸€è‡´æ€§ã€‚
            if (!posterUrl || String(posterUrl).includes("picsum.photos")) {
                return makeTextPoster(title || "æœªå‘½åå½±ç‰‡", seed);
            }
            return posterUrl;
        }

        function makeTextPoster(title, seed) {
            const safeTitle = String(title || "æœªå‘½åå½±ç‰‡").slice(0, 28);
            const s = String(seed || "seed");
            const hash = simpleHash(s);
            const hue1 = 180 + (hash % 40); // è“é’
            const hue2 = 260 + (hash % 50); // ç´«
            const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="400" height="600" viewBox="0 0 400 600">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="hsl(${hue1}, 90%, 55%)" stop-opacity="0.85"/>
      <stop offset="1" stop-color="hsl(${hue2}, 80%, 55%)" stop-opacity="0.85"/>
    </linearGradient>
    <filter id="n">
      <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/>
      <feColorMatrix type="matrix"
        values="0 0 0 0 0
                0 0 0 0 0.8
                0 0 0 0 1
                0 0 0 .18 0"/>
    </filter>
  </defs>

  <rect width="400" height="600" fill="#06070b"/>
  <rect width="400" height="600" fill="url(#g)"/>
  <rect width="400" height="600" filter="url(#n)" opacity="0.25"/>
  <rect x="24" y="24" width="352" height="552" rx="18" fill="rgba(0,0,0,0.35)" stroke="rgba(255,255,255,0.12)"/>

  <text x="40" y="120" fill="rgba(255,255,255,0.92)" font-size="18" font-family="Inter, system-ui, sans-serif" letter-spacing="2">DAHAI CINEMA</text>

  <text x="40" y="220" fill="rgba(255,255,255,0.95)" font-size="34" font-family="Inter, system-ui, sans-serif" font-weight="800">
    ${escapeXml(multilineTitle(safeTitle, 10)).join("")}
  </text>

  <text x="40" y="520" fill="rgba(255,255,255,0.7)" font-size="14" font-family="Inter, system-ui, sans-serif">
    æ²‰æµ¸å¼ç§äººè§‚å½±ä½“éªŒ
  </text>
</svg>`;
            return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
        }

        function multilineTitle(t, maxLen) {
            const str = String(t);
            const lines = [];
            let cur = "";
            for (const ch of str) {
                cur += ch;
                if (cur.length >= maxLen) {
                    lines.push(cur);
                    cur = "";
                }
            }
            if (cur) lines.push(cur);
            // æ¯è¡Œç”¨ <tspan> æ¢è¡Œ
            return lines.slice(0, 3).map((line, idx) => {
                const dy = idx === 0 ? 0 : 44;
                const y = idx === 0 ? 0 : dy;
                return `<tspan x="40" dy="${idx === 0 ? 0 : 44}">${line}</tspan>`;
            });
        }

        function escapeXml(s) {
            return String(s)
                .replaceAll("&", "&amp;")
                .replaceAll("<", "&lt;")
                .replaceAll(">", "&gt;")
                .replaceAll("\"", "&quot;")
                .replaceAll("'", "&apos;");
        }

        function simpleHash(str) {
            let h = 2166136261;
            for (let i = 0; i < str.length; i++) {
                h ^= str.charCodeAt(i);
                h = Math.imul(h, 16777619);
            }
            return Math.abs(h);
        }

        // =========================
        // 4) æ¸²æŸ“ï¼ˆäº‹ä»¶å§”æ‰˜ï¼šé¿å…é‡å¤ç»‘å®šï¼Œå‡å°‘â€œé”™ç»‘å¯¼è‡´æ ‡é¢˜ä¸ä¸€è‡´â€ï¼‰
        // =========================
        function generateMovieCard(movie) {
            const poster = movie.poster || makeTextPoster(movie.title, movie.bvid || movie.id);
            const year = movie.year || "";
            const rating = movie.rating || "";
            const duration = movie.duration || "";
            return `
                <div class="movie-card" data-id="${escapeHtmlAttr(movie.id)}">
                    <img src="${escapeHtmlAttr(poster)}" alt="${escapeHtmlAttr(movie.title || 'æœªå‘½å')}" class="card-img">
                    <div class="card-overlay">
                        <h3 class="card-title">${escapeHtml(movie.title || 'æœªå‘½å')}</h3>
                        <div class="card-meta">
                            <span>${escapeHtml(year)}</span>
                            <span>${rating ? 'â­ ' + escapeHtml(rating) : ''}</span>
                            <span>${escapeHtml(duration)}</span>
                        </div>
                        <div class="card-actions">
                            <button class="watch-btn" data-id="${escapeHtmlAttr(movie.id)}">
                                <i class="fas fa-play"></i> ç«‹å³è§‚çœ‹
                            </button>
                            <button class="info-btn" data-id="${escapeHtmlAttr(movie.id)}">
                                <i class="fas fa-info-circle"></i> è¯¦æƒ…
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function escapeHtml(s) {
            return String(s ?? "")
                .replaceAll("&", "&amp;")
                .replaceAll("<", "&lt;")
                .replaceAll(">", "&gt;")
                .replaceAll("\"", "&quot;")
                .replaceAll("'", "&#39;");
        }

        function escapeHtmlAttr(s) {
            return escapeHtml(s).replaceAll("\n", " ");
        }

        function renderGrid(el, items) {
            el.innerHTML = items.map(generateMovieCard).join("");
        }

        // =========================
        // 5) æ’­æ”¾ä¸è¯¦æƒ…ï¼ˆç»Ÿä¸€ä» Store å–æ•°æ®ï¼Œä¿è¯ä¸€è‡´ï¼‰
        // =========================
        async function openPlayer(movie) {
            const modal = document.getElementById('videoModal');
            const titleEl = document.getElementById('modalTitle');
            const container = document.getElementById('videoContainer');

            titleEl.textContent = `æ­£åœ¨æ’­æ”¾ï¼š${movie.title || 'æœªå‘½å'}`;
            container.innerHTML = `
                <div style="width:100%; text-align:center;">
                    <div class="loader" style="display:block;"></div>
                    <div style="margin-top:12px; color: rgba(224,224,224,0.75);">
                        æ­£åœ¨åŠ è½½æ’­æ”¾å™¨...
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            if (!movie.bvid) {
                container.innerHTML = `
                    <div style="text-align:center; padding: 2rem;">
                        <div style="font-size:1.2rem; color: rgba(255,255,255,0.85); margin-bottom: 8px;">è¯¥æ¡ç›®ç¼ºå°‘ BV å·</div>
                        <div style="color: rgba(224,224,224,0.7);">è¯·åœ¨æœç´¢æ¡†è¾“å…¥ BV å·æˆ– Bç«™é“¾æ¥ï¼Œå³å¯åŠ å…¥å¹¶æ’­æ”¾ã€‚</div>
                    </div>
                `;
                return;
            }

            // å…ˆæŠŠ iframe æ”¾å‡ºæ¥ï¼ˆæ’­æ”¾æœ€å¿«ï¼‰ï¼Œå†åå°æ ¡å‡†å°é¢/æ ‡é¢˜
            container.innerHTML = `
                <iframe 
                    src="https://player.bilibili.com/player.html?bvid=${encodeURIComponent(movie.bvid)}&autoplay=1&page=1"
                    width="100%" 
                    height="600" 
                    scrolling="no" 
                    frameborder="0" 
                    allowfullscreen="true"
                    referrerpolicy="no-referrer"
                    style="border-radius: 10px;"
                ></iframe>
            `;

            // åå°æ‹‰å–çœŸå®æ ‡é¢˜/å°é¢ï¼Œä¿®å¤â€œæ’­æ”¾å’Œæ ‡é¢˜ä¸ä¸€è‡´â€
            const updated = await syncMovieMeta(movie, { silent: true });
            if (updated && updated.title) {
                titleEl.textContent = `æ­£åœ¨æ’­æ”¾ï¼š${updated.title}`;
            }
        }

        async function openInfo(movie) {
            const modal = document.getElementById('videoModal');
            const titleEl = document.getElementById('modalTitle');
            const container = document.getElementById('videoContainer');

            // å°½é‡å…ˆåŒæ­¥ä¸€æ¬¡å…ƒä¿¡æ¯ï¼ˆè®©â€œæ ‡é¢˜/å°é¢/æ’­æ”¾â€ä¸€è‡´ï¼‰
            await syncMovieMeta(movie, { silent: true });

            titleEl.textContent = movie.title || 'å½±ç‰‡è¯¦æƒ…';
            const cats = Array.isArray(movie.category) ? movie.category : (movie.category ? [movie.category] : []);
            const poster = movie.poster || makeTextPoster(movie.title, movie.bvid || movie.id);

            container.innerHTML = `
                <div style="padding: 2rem; max-width: 900px; width: 100%;">
                    <div style="display: flex; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap;">
                        <img src="${escapeHtmlAttr(poster)}" alt="${escapeHtmlAttr(movie.title || 'æœªå‘½å')}" 
                             style="width: 200px; height: 300px; object-fit: cover; border-radius: 10px; border: 1px solid rgba(255,255,255,0.08);">
                        <div style="flex: 1; min-width: 240px;">
                            <h2 style="color: var(--primary); margin-bottom: 1rem; font-weight: 800;">${escapeHtml(movie.title || 'æœªå‘½å')}</h2>
                            <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; color: rgba(255,255,255,0.7);">
                                ${movie.year ? `<span>${escapeHtml(movie.year)}</span>` : ""}
                                ${movie.rating ? `<span>â­ ${escapeHtml(movie.rating)}</span>` : ""}
                                ${movie.duration ? `<span>${escapeHtml(movie.duration)}</span>` : ""}
                                ${movie.bvid ? `<span class="mono">${escapeHtml(movie.bvid)}</span>` : ""}
                            </div>
                            <div style="margin-bottom: 1.2rem;">
                                ${cats.map(cat => 
                                    `<span style="background: rgba(0,212,255,0.1); color: var(--primary); 
                                        padding: 0.3rem 0.8rem; border-radius: 15px; margin-right: 0.5rem; 
                                        font-size: 0.9rem;">${escapeHtml(cat)}</span>`
                                ).join('')}
                            </div>
                            <p style="line-height: 1.7; color: rgba(255,255,255,0.85);">
                                ${escapeHtml(movie.description || "æš‚æ— ç®€ä»‹")}
                            </p>

                            <div style="display:flex; gap: 12px; margin-top: 18px; flex-wrap: wrap;">
                                <button class="watch-btn" style="flex: 1; min-width: 200px; padding: 1rem; font-size: 1.05rem;"
                                        data-id="${escapeHtmlAttr(movie.id)}">
                                    <i class="fas fa-play"></i> ç«‹å³è§‚çœ‹
                                </button>
                                ${movie.bvid ? `
                                    <a href="https://www.bilibili.com/video/${encodeURIComponent(movie.bvid)}" target="_blank"
                                       style="flex: 1; min-width: 200px; text-decoration:none;">
                                        <button class="info-btn" style="width: 100%; padding: 1rem; font-size: 1.05rem;">
                                            <i class="fas fa-arrow-up-right-from-square"></i> æ‰“å¼€Bç«™é¡µé¢
                                        </button>
                                    </a>
                                ` : ""}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // =========================
        // 6) Bç«™å…ƒä¿¡æ¯åŒæ­¥ï¼šå°é¢/æ ‡é¢˜/æ—¶é•¿
        // =========================
        function cacheKeyForBvid(bvid) {
            return "bili_meta_" + bvid;
        }

        function readMetaCache(bvid) {
            try {
                const raw = localStorage.getItem(cacheKeyForBvid(bvid));
                if (!raw) return null;
                const obj = JSON.parse(raw);
                const ageMin = (Date.now() - obj.ts) / 60000;
                if (ageMin > CONFIG.metaCacheMinutes) return null;
                return obj.data || null;
            } catch {
                return null;
            }
        }

        function writeMetaCache(bvid, data) {
            try {
                localStorage.setItem(cacheKeyForBvid(bvid), JSON.stringify({ ts: Date.now(), data }));
            } catch {}
        }

        async function syncMovieMeta(movie, { silent } = { silent: false }) {
            if (!movie || !movie.bvid) return null;

            // å…ˆè¯»ç¼“å­˜
            const cached = readMetaCache(movie.bvid);
            if (cached) {
                applyMeta(movie, cached);
                rerenderIfVisible(movie);
                return movie;
            }

            // å†æ‹‰è¿œç¨‹
            const view = await fetchBiliView(movie.bvid, { silent });
            if (!view) return null;

            writeMetaCache(movie.bvid, view);
            applyMeta(movie, view);
            rerenderIfVisible(movie);
            return movie;
        }

        function applyMeta(movie, view) {
            // view: { title, pic, duration, desc, pubdate, owner, stat, ... }
            if (!view) return;

            const oldTitle = movie.title;
            if (view.title) movie.title = view.title;
            if (view.pic) movie.poster = normalizePoster(ensureHttps(view.pic), movie.title, movie.bvid || movie.id);

            // duration ç§’ -> xxåˆ†é’Ÿ æˆ– hh:mm:ss
            if (typeof view.duration === "number") {
                movie.duration = formatDuration(view.duration);
            }
            // desc
            if (view.desc && (!movie.description || movie.description.length < 10)) {
                movie.description = view.desc;
            }

            // å°è¯•æŠŠ year è®¾ä¸€ä¸‹ï¼ˆä¸å¼ºä¾èµ–ï¼‰
            if (!movie.year && typeof view.pubdate === "number") {
                const d = new Date(view.pubdate * 1000);
                movie.year = String(d.getFullYear());
            }

            // æ ‡è®°æ¥æº
            movie._source = "bili_view";
            movie._synced = true;

            // å¦‚æœæ ‡é¢˜å˜åŒ–éå¸¸å¤§ï¼Œè¯´æ˜ä½ åŸæ¥çš„â€œæ ‡é¢˜<->bvidâ€æ˜ å°„ä¸æ­£ç¡®
            // è¿™é‡Œè‡ªåŠ¨ä»¥çœŸå®æ ‡é¢˜ä¸ºå‡†ï¼Œä»æ ¹æºä¿®å¤â€œæ’­æ”¾æ ‡é¢˜ä¸ä¸€è‡´â€
            if (oldTitle && view.title && oldTitle !== view.title) {
                // no-op: ä»…è¯´æ˜åŸå› ï¼Œå·²ä»¥çœŸå®æ ‡é¢˜è¦†ç›–
            }
        }

        function ensureHttps(url) {
            if (!url) return url;
            if (url.startsWith("//")) return "https:" + url;
            return url;
        }

        function formatDuration(seconds) {
            const s = Math.max(0, Number(seconds) || 0);
            const h = Math.floor(s / 3600);
            const m = Math.floor((s % 3600) / 60);
            const sec = Math.floor(s % 60);
            if (h > 0) return `${h}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
            return `${m}:${String(sec).padStart(2,'0')}`;
        }

        function rerenderIfVisible(movie) {
            // ç®€å•åšæ³•ï¼šå¦‚æœåœ¨å½“å‰é¡µé¢ç½‘æ ¼é‡Œï¼Œä¸‹ä¸€æ¬¡æ¸²æŸ“ä¼šæ›´æ–°ï¼›
            // ä¸ºäº†ç›´è§‚ï¼šç›´æ¥å±€éƒ¨æ›´æ–° img/æ ‡é¢˜
            const cards = document.querySelectorAll(`.movie-card[data-id="${CSS.escape(String(movie.id))}"]`);
            cards.forEach(card => {
                const img = card.querySelector(".card-img");
                const titleEl = card.querySelector(".card-title");
                if (img && movie.poster) img.src = movie.poster;
                if (titleEl && movie.title) titleEl.textContent = movie.title;
                if (img && movie.title) img.alt = movie.title;
            });
        }

        async function fetchBiliView(bvid, { silent } = { silent: false }) {
            const url = `https://api.bilibili.com/x/web-interface/view?bvid=${encodeURIComponent(bvid)}`;
            const json = await apiFetchJson(url, { silent });
            if (!json || json.code !== 0 || !json.data) return null;
            return json.data;
        }

        async function fetchBiliPopular(pn, ps, { silent } = { silent: false }) {
            const url = `https://api.bilibili.com/x/web-interface/popular?pn=${encodeURIComponent(pn)}&ps=${encodeURIComponent(ps)}`;
            const json = await apiFetchJson(url, { silent });
            if (!json || json.code !== 0 || !json.data || !Array.isArray(json.data.list)) return null;
            return json.data.list;
        }
        // =========================
        // 5.5) çƒ­é—¨ç‰‡åº“â€œé¢„çƒ­â€ï¼ˆç”¨äºï¼šæœç´¢æ¥å£è¢«æ‹¦æˆªæ—¶ä»èƒ½é€šè¿‡å…³é”®è¯æ‰¾åˆ°æ›´å¤šå†…å®¹ï¼‰
        // =========================
        async function seedFromPopular(pages = 3, ps = 24, { silent } = { silent: true }) {
            try {
                if (!Store._popularSeededPages) Store._popularSeededPages = new Set();

                for (let p = 1; p <= pages; p++) {
                    if (Store._popularSeededPages.has(p)) continue;

                    const list = await fetchBiliPopular(p, ps, { silent });
                    if (Array.isArray(list) && list.length > 0) {
                        list.forEach(v => {
                            const movie = upsertMovie({
                                id: v.bvid || v.aid || cryptoRandomId(),
                                title: v.title || (v.bvid || "æœªå‘½å"),
                                year: "",
                                rating: "",
                                duration: v.duration ? formatDuration(v.duration) : "",
                                category: ["çƒ­é—¨æ¨è"],
                                poster: ensureHttps(v.pic || v.cover || ""),
                                bvid: v.bvid || "",
                                description: v.desc || ""
                            });
                            movie._source = "bili_popular_seed";
                        });
                        Store._popularSeededPages.add(p);
                    } else {
                        // æ¥å£æ²¡æ•°æ®å°±åˆ«ç»§ç»­åˆ·äº†
                        Store._popularSeededPages.add(p);
                    }
                }
            } catch (e) {
                // å¿½ç•¥ï¼šä¸å½±å“ä¸»æµç¨‹
            }
        }



        async function fetchBiliSearch(keyword, page, pageSize, { silent } = { silent: false }) {
            const url = `https://api.bilibili.com/x/web-interface/search/type?search_type=video&keyword=${encodeURIComponent(keyword)}&page=${encodeURIComponent(page)}&page_size=${encodeURIComponent(pageSize)}`;
            const json = await apiFetchJson(url, { silent });
            if (!json || json.code !== 0 || !json.data) return null;
            const res = json.data.result || [];
            return Array.isArray(res) ? res : [];
        }

        async function apiFetchJson(url, { silent } = { silent: false }) {
            const target = CONFIG.apiProxy ? (CONFIG.apiProxy + encodeURIComponent(url)) : url;
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 8000);

            try {
                const resp = await fetch(target, {
                    method: "GET",
                    signal: controller.signal,
                    headers: {
                        // ä¸€äº›ç¯å¢ƒéœ€è¦å¸¦ referer/user-agent æ‰ç¨³ï¼Œè¿™é‡Œå°½é‡å…¼å®¹
                        "Accept": "application/json"
                    }
                });
                clearTimeout(timeout);
                if (!resp.ok) {
                    if (!silent) toast(`è¯·æ±‚å¤±è´¥ï¼š${resp.status}`, `æ— æ³•æ‹‰å–æ›´å¤šè§†é¢‘æ•°æ®ã€‚ä½ å¯ä»¥ç¨åé‡è¯•ï¼Œæˆ–é…ç½® API ä»£ç†ã€‚`);
                    return null;
                }
                const json = await resp.json();
                return json;
            } catch (e) {
                clearTimeout(timeout);

                // å¸¸è§ï¼šTypeError: Failed to fetchï¼ˆCORS æˆ–ç½‘ç»œï¼‰
                if (!silent) {
                    toast("æ— æ³•è®¿é—®è§†é¢‘æ•°æ®æ¥å£", "ä½ çš„éƒ¨ç½²ç¯å¢ƒå¯èƒ½é™åˆ¶è·¨åŸŸï¼ˆCORSï¼‰ï¼Œå¯¼è‡´æ— æ³•æ‹‰å–â€œæ›´å¤šæ¨è/åœ¨çº¿æœç´¢/è‡ªåŠ¨æ ¡å‡†å°é¢æ ‡é¢˜â€ã€‚\n\nâœ… è§£å†³ï¼šé…ç½® CONFIG.apiProxyï¼ˆCloudflare Worker ç­‰ï¼‰å³å¯ã€‚", [
                        { text: "çŸ¥é“äº†", action: () => hideToast() }
                    ]);
                }
                return null;
            }
        }

        // =========================
        // 7) æœç´¢ï¼šæœ¬åœ°ç­›é€‰ + åœ¨çº¿è¡¥å…¨ï¼ˆå…³é”®è¯/åˆ†ç±»ï¼‰
        // =========================
        function parseBvid(input) {
            const str = String(input || "");
            const m = str.match(/BV[0-9A-Za-z]{10}/i);
            return m ? m[0].toUpperCase() : null;
        }

        function localSearch(keyword) {
            const q = String(keyword || "").trim().toLowerCase();
            if (!q) return [];
            const items = Array.from(Store.byId.values());
            return items.filter(m => {
                const hay = [
                    m.title, m.year, m.duration, m.description,
                    Array.isArray(m.category) ? m.category.join(" ") : m.category
                ].filter(Boolean).join(" ").toLowerCase();
                return hay.includes(q);
            });
        }

        async function performSearch({ append } = { append: false }) {
            const input = document.getElementById('searchInput');
            const query = (input.value || "").trim();
            if (!query) return;

            const loader = document.getElementById('loader');
            loader.style.display = 'block';

            // å¦‚æœè¾“å…¥ BV å· / Bç«™é“¾æ¥ï¼šç›´æ¥åŠ å…¥å¹¶æ’­æ”¾
            const bvid = parseBvid(query);
            if (bvid) {
                loader.style.display = 'none';
                const existing = Store.byBvid.get(bvid);
                const movie = existing || upsertMovie({
                    id: bvid,
                    title: bvid,
                    year: "",
                    rating: "",
                    duration: "",
                    category: ["æ¥è‡ªæœç´¢"],
                    poster: "",
                    bvid,
                    description: "ä» Bç«™ BV å·/é“¾æ¥æ·»åŠ çš„èµ„æºã€‚"
                });

                // å…ˆåŒæ­¥æ ‡é¢˜å°é¢ï¼Œå†æ’­æ”¾ï¼ˆæ›´ä¸€è‡´ï¼‰
                await syncMovieMeta(movie, { silent: true });
                await openPlayer(movie);
                return;
            }

            // æœ¬åœ°ç»“æœ
            const local = localSearch(query);

            // æ˜¾ç¤ºç»“æœå®¹å™¨
            showSearchSection(true);
            document.getElementById('emptyHint').style.display = 'none';

            // åœ¨çº¿æœç´¢è¡¥å…¨
            if (!append) {
                Store.search.keyword = query;
                Store.search.page = 1;
                Store.search.hasMore = false;
                // å…ˆç”¨æœ¬åœ°ç»“æœæ¸²æŸ“
                renderGrid(document.getElementById('searchMovies'), local.slice(0, CONFIG.searchPageSize));
            }

            // å¦‚æœæœ¬åœ°å¤Ÿå¤šä¸”ä¸è¿½åŠ ï¼Œå°±ä¸ç”¨è¿œç¨‹
            if (!append && local.length >= 12) {
                loader.style.display = 'none';
                document.getElementById('searchMoreRow').style.display = 'none';
                return;
            }

            // è¿œç¨‹æœç´¢ï¼ˆéœ€è¦ API å¯è®¿é—®ï¼‰
            const page = append ? (Store.search.page + 1) : 1;
            const remote = await fetchBiliSearch(query, page, CONFIG.searchPageSize, { silent: true });

            loader.style.display = 'none';

            if (!remote || remote.length === 0) {
                // è¿œç¨‹ä¸å¯ç”¨ / æ²¡ç»“æœ

                // è‹¥å·²é…ç½® apiProxyï¼Œä½†æœç´¢æ¥å£å¯èƒ½è¢«æ‹¦æˆªï¼ˆä¾‹å¦‚ -412ï¼‰ï¼Œè¿™é‡Œå°è¯•ï¼š
                // å…ˆæ‹‰å–å‡ é¡µâ€œçƒ­é—¨åˆ—è¡¨â€æ‰©å……ç‰‡åº“ï¼Œå†åšä¸€æ¬¡æœ¬åœ°å…³é”®è¯åŒ¹é…ï¼ˆä¸ä¾èµ–æœç´¢æ¥å£ï¼‰
                if (!append && CONFIG.apiProxy) {
                    await seedFromPopular(3, 24, { silent: true });
                    const local2 = localSearch(query);
                    if (local2.length > 0) {
                        renderGrid(document.getElementById('searchMovies'), local2.slice(0, CONFIG.searchPageSize));
                        Store.search.hasMore = local2.length > CONFIG.searchPageSize;
                        document.getElementById('searchMoreRow').style.display = Store.search.hasMore ? 'flex' : 'none';
                        return;
                    }
                }
                if (!append && local.length === 0) {
                    showEmpty(`æ²¡æœ‰æ‰¾åˆ°ä¸ â€œ${escapeHtml(query)}â€ ç›¸å…³çš„å½±ç‰‡ã€‚ä½ å¯ä»¥å°è¯•ï¼š\n1) è¾“å…¥ BV å· / Bç«™é“¾æ¥\n2) æˆ–é…ç½® apiProxy å¯ç”¨åœ¨çº¿æœç´¢`);
                }
                document.getElementById('searchMoreRow').style.display = 'none';
                return;
            }

            // è½¬æ¢è¿œç¨‹ç»“æœä¸º movie
            const remoteMovies = remote.map(r => {
                const title = stripHtml(r.title || "");
                const m = upsertMovie({
                    id: r.bvid || cryptoRandomId(),
                    title: title || (r.bvid || "æœªå‘½å"),
                    year: "",
                    rating: "",
                    duration: r.duration || "",
                    category: ["æ¥è‡ªæœç´¢"],
                    poster: ensureHttps(r.pic || ""),
                    bvid: r.bvid || "",
                    description: stripHtml(r.description || "")
                });
                m._source = "bili_search";
                return m;
            });

            // åˆå¹¶å±•ç¤º
            const grid = document.getElementById('searchMovies');
            const currentHtml = grid.innerHTML;
            if (append && currentHtml) {
                grid.innerHTML += remoteMovies.map(generateMovieCard).join("");
            } else {
                // åˆå¹¶æœ¬åœ° + è¿œç¨‹å»é‡ï¼ˆä»¥ bvid/id ä¸ºä¸»ï¼‰
                const merged = [];
                const seen = new Set();
                local.forEach(m => {
                    const k = m.bvid || m.id;
                    if (!seen.has(k)) { merged.push(m); seen.add(k); }
                });
                remoteMovies.forEach(m => {
                    const k = m.bvid || m.id;
                    if (!seen.has(k)) { merged.push(m); seen.add(k); }
                });
                renderGrid(grid, merged);
            }

            // åˆ†é¡µ
            Store.search.page = page;
            // Bç«™æœç´¢ä¸€èˆ¬å¯ä»¥æ›´å¤šé¡µï¼Œè¿™é‡Œç›´æ¥ç»™â€œåŠ è½½æ›´å¤šâ€æŒ‰é’®
            Store.search.hasMore = true;
            document.getElementById('searchMoreRow').style.display = 'flex';
        }

        function stripHtml(html) {
            return String(html || "").replace(/<[^>]+>/g, "");
        }

        function showSearchSection(show) {
            const title = document.getElementById('searchTitle');
            const grid = document.getElementById('searchMovies');
            title.style.display = show ? "flex" : "none";
            grid.style.display = show ? "grid" : "none";
        }

        function showEmpty(text) {
            const el = document.getElementById('emptyHint');
            el.innerHTML = `<div style="white-space: pre-line;">${escapeHtml(text)}</div>`;
            el.style.display = 'block';
        }

        function hideEmpty() {
            const el = document.getElementById('emptyHint');
            el.style.display = 'none';
            el.textContent = '';
        }

        function searchByCategory(category) {
            const categoryKeywords = {
                'action': 'åŠ¨ä½œ',
                'sci-fi': 'ç§‘å¹»',
                'drama': 'å‰§æƒ…',
                'comedy': 'å–œå‰§',
                'anime': 'åŠ¨æ¼«'
            };
            const kw = categoryKeywords[category] || category;
            document.getElementById('searchInput').value = kw;
            performSearch({ append: false });
        }

        // =========================
        // 8) æ›´å¤šæ¨èï¼ˆçƒ­é—¨æ¦œå•ï¼‰ï¼šæ˜¾è‘—å¢åŠ è§†é¢‘æ•°é‡
        // =========================
        async function loadDiscover({ refresh } = { refresh: false }) {
            const titleEl = document.getElementById('discoverTitle');
            const gridEl = document.getElementById('discoverMovies');
            const rowEl = document.getElementById('discoverMoreRow');
            const loader = document.getElementById('loader');

            if (refresh) Store.discover.page += 1;
            const page = Store.discover.page;

            loader.style.display = 'block';
            const list = await fetchBiliPopular(page, CONFIG.discoverPageSize, { silent: true });
            loader.style.display = 'none';

            if (!list || list.length === 0) {
                // å¦‚æœæ¥å£ä¸å¯ç”¨ï¼Œåˆ™ä¸æ˜¾ç¤ºâ€œæ›´å¤šæ¨èâ€é¿å…å¹²æ‰°
                titleEl.style.display = 'none';
                gridEl.style.display = 'none';
                rowEl.style.display = 'none';
                return;
            }

            const discoverMovies = list.map(v => {
                const m = upsertMovie({
                    id: v.bvid || cryptoRandomId(),
                    title: v.title || (v.bvid || "æœªå‘½å"),
                    year: "",
                    rating: "",
                    duration: typeof v.duration === "number" ? formatDuration(v.duration) : "",
                    category: ["çƒ­é—¨æ¨è"],
                    poster: ensureHttps(v.pic || ""),
                    bvid: v.bvid || "",
                    description: v.desc || ""
                });
                m._source = "bili_popular";
                return m;
            });

            titleEl.style.display = 'flex';
            gridEl.style.display = 'grid';
            rowEl.style.display = 'flex';

            renderGrid(gridEl, discoverMovies);
        }

        // =========================
        // 9) åˆå§‹åŒ–ï¼šæ¸²æŸ“æœ¬åœ°åˆ—è¡¨ + å¯é€‰æ ¡å‡†å…ƒä¿¡æ¯
        // =========================
        function initMovies() {
            // æŠŠæœ¬åœ°æ•°æ®æ”¾å…¥ Store
            const hot = movies.hot.map(m => upsertMovie({ ...m }));
            const nw = movies.new.map(m => upsertMovie({ ...m }));

            renderGrid(document.getElementById('hotMovies'), hot);
            renderGrid(document.getElementById('newMovies'), nw);

            // å¯é€‰ï¼šé¡µé¢åŠ è½½è‡ªåŠ¨æ ¡å‡†ï¼ˆèƒ½è®¿é—® API æ—¶ä¼šæŠŠæ ‡é¢˜/å°é¢æ”¹ä¸ºçœŸå®ï¼‰
            if (CONFIG.syncMetaOnLoad) {
                // å°æ‰¹é‡å¹¶å‘ï¼Œé¿å…å¡é¡¿
                const seed = [...hot, ...nw].filter(m => m.bvid);
                batchSync(seed, 3);
            }
        }

        async function batchSync(list, concurrency) {
            const queue = [...list];
            const workers = new Array(concurrency).fill(0).map(async () => {
                while (queue.length) {
                    const movie = queue.shift();
                    if (!movie) break;
                    await syncMovieMeta(movie, { silent: true });
                }
            });
            await Promise.all(workers);
        }

        function initSearch() {
            const searchBtn = document.getElementById('searchBtn');
            const searchInput = document.getElementById('searchInput');
            const moreBtn = document.getElementById('searchMoreBtn');

            searchBtn.addEventListener('click', () => performSearch({ append: false }));
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch({ append: false });
            });
            moreBtn.addEventListener('click', () => performSearch({ append: true }));

            // å¿«é€Ÿé“¾æ¥
            document.querySelectorAll('.quick-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const category = this.getAttribute('data-category');
                    searchByCategory(category);
                });
            });
        }

        // ç»Ÿä¸€ç‚¹å‡»å¤„ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰
        document.addEventListener("click", async (e) => {
            const watchBtn = e.target.closest(".watch-btn");
            const infoBtn = e.target.closest(".info-btn");
            const card = e.target.closest(".movie-card");

            if (watchBtn) {
                e.preventDefault();
                e.stopPropagation();
                const id = watchBtn.getAttribute("data-id");
                const movie = Store.byId.get(String(id));
                if (movie) await openPlayer(movie);
                return;
            }

            if (infoBtn) {
                e.preventDefault();
                e.stopPropagation();
                const id = infoBtn.getAttribute("data-id");
                const movie = Store.byId.get(String(id));
                if (movie) await openInfo(movie);
                return;
            }

            if (card) {
                const id = card.getAttribute("data-id");
                const movie = Store.byId.get(String(id));
                if (movie) await openInfo(movie);
                return;
            }
        });

        // å…³é—­æ¨¡æ€æ¡†
        document.getElementById('closeModal').addEventListener('click', closeModal);

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.getElementById('videoModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        function closeModal() {
            const modal = document.getElementById('videoModal');
            const container = document.getElementById('videoContainer');
            modal.style.display = 'none';
            container.innerHTML = '';
            document.body.style.overflow = 'auto';
        }

        // ç”¨æˆ·æŒ‰é’®
        document.getElementById('userBtn').addEventListener('click', function() {
            alert(`ğŸ‘¤ ç”¨æˆ·ï¼šå¤§æµ·\nğŸ“§ é‚®ç®±ï¼šdahai@example.com\nâ­ æ”¶è—ï¼š32 éƒ¨å½±ç‰‡\n\næ¬¢è¿æ¥åˆ°æ‚¨çš„ç§äººå½±é™¢ï¼`);
        });

        // æ›´å¤šæ¨èæŒ‰é’®
        document.getElementById('discoverMoreBtn').addEventListener('click', function() {
            loadDiscover({ refresh: true });
        });

        // =========================
        // 10) Toast
        // =========================
        function toast(title, text, actions) {
            const t = document.getElementById("toast");
            const tt = document.getElementById("toastTitle");
            const tx = document.getElementById("toastText");
            const ta = document.getElementById("toastActions");

            tt.textContent = title || "æç¤º";
            tx.textContent = text || "";
            ta.innerHTML = "";

            (actions || []).forEach(a => {
                const btn = document.createElement("button");
                btn.textContent = a.text;
                btn.addEventListener("click", () => {
                    try { a.action && a.action(); } catch {}
                });
                ta.appendChild(btn);
            });

            t.style.display = "block";
            clearTimeout(t._hideTimer);
            t._hideTimer = setTimeout(() => {
                hideToast();
            }, 9000);
        }

        function hideToast() {
            const t = document.getElementById("toast");
            t.style.display = "none";
        }

        // =========================
        // 11) é¡µé¢åŠ è½½
        // =========================
        document.addEventListener('DOMContentLoaded', function() {
            // èƒŒæ™¯ç‰¹æ•ˆéé˜»å¡åŠ è½½ï¼ˆå¤±è´¥ä¹Ÿä¸å½±å“ä¸»åŠŸèƒ½ï¼‰
            initParticlesBackground();

            initMovies();
            initSearch();
            hideEmpty();

            // å°è¯•åŠ è½½â€œæ›´å¤šæ¨èâ€ï¼ˆæˆåŠŸåˆ™è§†é¢‘æ•°é‡æ˜¾è‘—å¢åŠ ï¼‰
            loadDiscover({ refresh: false });
        });

        // å…¼å®¹æ—§è°ƒç”¨ï¼ˆå¦‚æœä½ æœªæ¥è¿˜æœ‰å…¶ä»–è„šæœ¬å¼•ç”¨ï¼‰
        window.playVideo = async function(bvid, title) {
            const movie = upsertMovie({
                id: bvid || cryptoRandomId(),
                title: title || bvid || "æœªå‘½å",
                bvid: bvid || "",
                poster: "",
                category: ["å¤–éƒ¨è°ƒç”¨"],
                description: ""
            });
            await syncMovieMeta(movie, { silent: true });
            await openPlayer(movie);
        };
    </script>
</body>
</html>
